<mat-form-field appearance="outline">
    <mat-label>{{ label$() }}</mat-label>

    <mat-select 
        [value]="value()" 
        [disabled]="isDisabled()"
        (selectionChange)="onSelectionChange($event)"
        panelClass="profile-select-panel">

        <mat-select-trigger>
            @if (selectedItem(); as item) {
                <div class="select-value-row">
                    <io-profile-avatar [profile]="item"></io-profile-avatar>
                    <div class="text-stack">
                        <span class="name">
                            {{ item.name || (item.firstName + ' ' + item.lastName) }}
                        </span>
                    </div>
                </div>
            } @else {
                <div class="select-value-row">
                    <mat-icon class="empty-icon">person_off</mat-icon>
                    <span class="muted">{{ nullLabel$() }}</span>
                </div>
            }
        </mat-select-trigger>

        <mat-option [value]="null">
            <div class="select-value-row">
                <mat-icon class="empty-icon">person_off</mat-icon>
                <span class="muted">{{ nullLabel$() }}</span>
            </div>
        </mat-option>

        @for (item of items$(); track item[idKey$()]) {
            <mat-option [value]="item[idKey$()]">
                <div class="select-value-row">
                    <io-profile-avatar [profile]="item"></io-profile-avatar>
                    <div class="text-stack">
                        <span class="name">
                            {{ item.name || (item.firstName + ' ' + item.lastName) }}
                        </span>
                    </div>
                </div>
            </mat-option>
        }

    </mat-select>
</mat-form-field>